<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="app.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="footer.css">
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"
    integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c=" crossorigin="anonymous"></script>
  <!-- jqury kniznica na obmedzenie maximalneho poctu poloziek v autocomplete  -->
  <script src="jquery.ui.autocomplete.scroll.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.css" rel="stylesheet" />
  <title>Document</title>
</head>

<body>
  <script>
    function includeHTML() {
      var z, i, elmnt, file, xhttp;
      /* Loop through a collection of all HTML elements: */
      z = document.getElementsByTagName("*");
      for (i = 0; i < z.length; i++) {
        elmnt = z[i];
        /*search for elements with a certain atrribute:*/
        file = elmnt.getAttribute("w3-include-html");
        if (file) {
          /* Make an HTTP request using the attribute value as the file name: */
          xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function () {
            if (this.readyState == 4) {
              if (this.status == 200) { elmnt.innerHTML = this.responseText; }
              if (this.status == 404) { elmnt.innerHTML = "Page not found."; }
              /* Remove the attribute, and call this function once more: */
              elmnt.removeAttribute("w3-include-html");
              includeHTML();
            }
          }
          xhttp.open("GET", file, true);
          xhttp.send();
          /* Exit the function: */
          return;
        }
      }
    }

  </script>

  <div w3-include-html="navbar.html"></div>
  <div class="container ">

    <!-- <form class="mt-5" method="POST"> -->
    <h2 class="mt-4">hladat pomocou</h2>
    <div class="form-check">
      <input class="form-check-input1" type="radio" name="exampleRadios" id="id_checkbox" value="option1">
      <label class="form-check-label" for="exampleRadios1">
        Id knihy
      </label>
    </div>
    <div class="form-check">
      <input class="form-check-input2" type="radio" name="exampleRadios" id="name_checkbox" value="option2">
      <label class="form-check-label" for="exampleRadios2">
        Meno knihy
      </label>
    </div>
    <div class="form-check">
      <input class="form-check-input2" type="radio" name="exampleRadios" id="isbn_checkbox" value="option2">
      <label class="form-check-label" for="exampleRadios2">
        ISBN
      </label>
    </div>
    <div id="input_place" class="col">

    </div>
    <div class="card mt-4">
      <div class="card-body">
        <h3 id="nazov_hore" class="card-title">Book Name</h3>
        <h6 id="autori_hore" class="card-subtitle">Book Authors</h6>
        <div class="row ">
          <div class="col-lg-6 col-md-8 col-sm-12 col-12 ">
            <div class=" img-responsive"><img id="obrazok" src="https://via.placeholder.com/430x600/00CED1/000000">
            </div>
          </div>
          <div class="col-lg-6 col-md-4 col-sm-12 col-12">
            <h4 class="box-title ">Obsah knihy</h4>
            <p id="obsah"></p>
            <h2 id="cena_hl" class="mt-2">
            </h2>
            <h3 class="box-title mt-5">údaje o knihe</h3>
            <ul class="list-unstyled">
              <li><i class="fa fa-check text-success"></i>nazov: <span id="nazov"></span></li>
              <li><i class="fa fa-check text-success"></i>autori: <span id="autori"></span></li>
              <li><i class="fa fa-check text-success"></i>kategoria: <span id="kategoria"></span></li>
              <li><i class="fa fa-check text-success"></i>isbn: <span id="isbn"></span></li>
              <li><i class="fa fa-check text-success"></i>jazyk: <span id="jazyk"></span></li>
              <li><i class="fa fa-check text-success"></i>pocet stran: <span id="pocet_stran"></span></li>
              <li><i class="fa fa-check text-success"></i>rok vydania: <span id="rok_vydania"></span></li>
              <li><i class="fa fa-check text-success"></i>vydavateľstvo: <span id="vydavatelstvo"></span>
              </li>
              <li><i class="fa fa-check text-success"></i>predajna cena: <span id="predajna_cena"></span>
              </li>
              <li><i class="fa fa-check text-success"></i>nakupna cena: <span id="nakupna_cena"></span></li>
              <li><i class="fa fa-check text-success"></i>marza: <span id="marza"></span></li>
              <li><i class="fa fa-check text-success"></i>zisk kus: <span id="zisk_kus"></span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function ajaxSingleBookForm(formid, url, parameter, parameterdata) {
      $(document).on('submit', formid, function (event) {
        console.log(parameterdata)
        var formData = {};
        formData[parameter] = $("#" + parameterdata).val();

        $.ajax({
          url: url,
          method: "POST",
          data: formData,
          dataType: "json",
          encode: true,
        }).done(function (data) {
          if (data.book.autori.autor2 != undefined) {
            $("#autori").html(data.book.autori.autor1 + "," + data.book.autori.autor2)
            $("#autori_hore").html(data.book.autori.autor1 + "," + data.book.autori.autor2)
          }
          else {
            $("#autori").html(data.book.autori.autor1)
            $("#autori_hore").html(data.book.autori.autor1)
          }
          $("#obrazok").attr('src', data.book.obrazok)
          $("#obsah").html(data.book.obsah)
          $("#cena_hl").html("€" + data.book.predajna_cena)
          $("#nazov_hore").html(data.book.nazov)
          $("#nazov").html(data.book.nazov)
          $("#kategoria").html(data.book.kategoria)
          $("#isbn").html(data.book.isbn)
          $("#jazyk").html(data.book.jazyk)
          $("#pocet_stran").html(data.book.pocet_stran)
          $("#rok_vydania").html(data.book.rok_vydania)
          $("#vydavatelstvo").html(data.book.vydavatelstvo)
          $("#predajna_cena").html(data.book.predajna_cena)
          $("#nakupna_cena").html(data.book.nakupna_cena)
          $("#marza").html(parseFloat(data.book.marza).toFixed(2) * 100 + "%")
          $("#zisk_kus").html(data.book.zisk_kus)
        })
        event.preventDefault();
      })
    }
    // asynchronna funkcia vracia promise 
    async function Getallbook() {
      // await zabezpeci sychronny priebeh a caka kym nedostane promise 
      const result = await $.ajax({
        url: 'http://localhost:8045/book_services.asmx/GetListAllBooks',
        type: "POST",
        dataType: 'json',
      }).done(function (data) { })

      return result.books.book
    }

  </script>
  <script>
    $(function () {
      $("#id_checkbox").click(function () {
        if ($(this).is(":checked")) {
          $("#input_place").html("<form id=\"formid\" class=\"mt-5\" method=\"POST\">" +
            " <div class=\"form-row mt-3\">" +

            " <label for=\"inputEmail\">ID knihy</label>" +
            "<input type=\"text\" class=\"form-control \" id=\"id_input\" placeholder=\"Book ID\" name=\"id\">" +
            " </div>" +
            " </div>" +
            " <button type=\"submit\" class=\"btn btn-primary  mt-2\">Find Book</button>" +
            "</form>")
        }
      })
    });
    $(function () {
      $("#name_checkbox").click(function () {
        if ($(this).is(":checked")) {
          $("#input_place").html("<form id=\"formname\" class=\"mt-5\" method=\"POST\">" +
            " <div class=\"form-row mt-3\">" +

            " <label for=\"inputEmail\">Nazov knihy</label>" +
            "<input type=\"text\" class=\"form-control\" id=\"name_input\" placeholder=\"nazov knihy\" name=\"name\">" +
            " </div>" +
            " </div>" +
            " <button type=\"submit\" class=\"btn btn-primary  mt-2\">Find Book</button>" +
            "</form>")
        }
      })
    });
    $(function () {
      $("#isbn_checkbox").click(function () {
        if ($(this).is(":checked")) {
          $("#input_place").html("<form  id=\"formisbn\" class=\"mt-5\" method=\"POST\">" +
            " <div class=\"form-row mt-3\">" +

            " <label for=\"inputEmail\">ISBN knihy</label>" +
            "<input type=\"text\" class=\"form-control\" id=\"isbn_input\" placeholder=\"ISBN\" name=\"isbn\">" +
            " </div>" +
            " </div>" +
            " <button type=\"submit\" class=\"btn btn-primary  mt-2\">Find Book</button>" +
            "</form>")
        }
      })
    });
  </script>

  <div w3-include-html="footer.html"></div>


  <script>
    includeHTML();
    ajaxSingleBookForm("#formid", "http://localhost:8045/book_services.asmx/SinglebookDataById", "id", "id_input")
    ajaxSingleBookForm("#formname", "http://localhost:8045/book_services.asmx/SinglebookDataByName", "name", "name_input")
    ajaxSingleBookForm("#formisbn", "http://localhost:8045/book_services.asmx/SinglebookDataByIsbn", "isbn", "isbn_input")

  </script>

  <script>
    // naplnenie pola bookNamesArray s menami vsetkych knih ziskanych zo strany servera 
    let bookNamesArray = []
    let bookIdArray = []
    let bookIsbnArray = []
    let attributename = "nazov"
    let atributeid = "id"
    let atributeisbn = "isbn"
    createArrayFromOneAttribute(attributename, bookNamesArray)
    createArrayFromOneAttribute(atributeid, bookIdArray)
    createArrayFromOneAttribute(atributeisbn, bookIsbnArray)
    // naplni vybrane pole udajom o jednom atribute vsetkzch knih 
    function createArrayFromOneAttribute(attribute, array) {

      Getallbook().then((data) => {
        for (values of data) {
          array.push(values[attribute])
        }
      })
    }
    // do zadaneho inputu prida autonavhy 
    function autoCompleteInput(inputSelector, maxItem, sourceArray) {
      var selector = inputSelector;
      $(document).on("click", selector, function () {
        $(this).autocomplete({
          maxShowItems: maxItem, // Make list height fit to 5 items when items are over 5.
          source: sourceArray
        });
      });
    }
    nameInputId = '#name_input'
    isbnInputId = '#isbn_input'
    idInputId = '#id_input'
    autoCompleteInput(nameInputId, 5, bookNamesArray)
    autoCompleteInput(isbnInputId, 5, bookIsbnArray)
    autoCompleteInput(idInputId, 5, bookIdArray)

  </script>



</body>

</html>