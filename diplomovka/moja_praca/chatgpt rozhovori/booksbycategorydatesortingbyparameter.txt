This code first joins the two XML files and then groups the warehouseXml elements by the bookId attribute. For each group, the nearest date is selected based on the difference between the date in the XML and the start date, using Math.Abs((DateTime.Parse((string)x.Attribute("date")) - startDate).Ticks). The Take(1) method is used to select only the nearest date. The rest of the code is the same as in the previous example.