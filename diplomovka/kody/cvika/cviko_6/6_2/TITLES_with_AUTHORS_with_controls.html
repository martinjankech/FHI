<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>

  <title>Titles with authors with controls</title>

  <script type="text/javascript">
  function loadXMLDoc(dname)
  {
    if (window.XMLHttpRequest)
    {
      xhttp=new XMLHttpRequest();
    }
    else
    {
      xhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xhttp.open("GET",dname,false);
    xhttp.send("");
    return xhttp.responseXML;
  }

  //funkcia zisti pocet elementov 'book', ktore maju v dcerskom elemente 'year' pouzivatelom hladanu hodnotu 
  //a vypise hodnoty dcerskych elementov 'title' a 'author' takychto 'book' elementov   
  function Find_title_with_authors_year()
  {
    //ziskanie hodnoty z textoveho pola formulara web stranky s 'id' "user_value"
    //a jej vlozenie do premennej 'x'
    var x=document.getElementById("user_value").value; 
    if (x==2003)
    {     //cestny vyraz, ktory vyberie vsetky elementy 'title' elementov 'book', ktorych detske elementy 'year' 
          //maju hodnotu totoznu s '2003'
          //A (sucasne)
          //vsetky elementy 'author' elementov 'book', ktorych detske elementy 'year' 
          //maju hodnotu totoznu s '2003'
      path="/bookstore/book[year=2003]/title | /bookstore/book[year=2003]/author";
      path_title_count="/bookstore/book[year=2003]/title";
    }
    else if (x==2005)
    {     //cestny vyraz, ktory vyberie vsetky elementy 'title' elementov 'book', ktorych detske elementy 'year' 
          //maju hodnotu totoznu s '2005'
          //A (sucasne)
          //vsetky elementy 'author' elementov 'book', ktorych detske elementy 'year' 
          //maju hodnotu totoznu s '2005'
      path="/bookstore/book[year=2005]/title | /bookstore/book[year=2005]/author";
      path_title_count="/bookstore/book[year=2005]/title";
    }
    else if (x!=2003 || x!=2005) //zabranenie vlozenia neplatnej hodnoty elementu 'year' pouzivatelom
    {
      alert("Vlozili ste nekorektnu hodnotu !!!\nMusite vlozit korektny rok !!!");
      document.getElementById("user_value").focus();
      return; //ak pouzivatel vlozil neplatnu hodnotu elementu 'year', tak tu tymto prikazom cela funkcia skonci
    }

    var string = "";

    //kod pre IE 5 a 6
    if (window.ActiveXObject)
    {
      var nodes=xml.selectNodes(path);

      for (i=0;i<nodes.length;i++)
      {
        document.write(nodes[i].childNodes[0].nodeValue);
        document.write("<br />");
      }
    }
    //kod pre Mozillu Firefox, Operu atd.
    else if (document.implementation && document.implementation.createDocument)
    {
      var nodes=xml.evaluate(path, xml, null, XPathResult.ANY_TYPE, null);
      var result=nodes.iterateNext();
      
      var nodes_title=xml.evaluate(path_title_count, xml, null, XPathResult.ANY_TYPE, null);
      var result_title=nodes_title.iterateNext();
      var count=0;

      //zistenie poctu elementov 'book' s pouzivatelom zadanou hodnotou detskeho elementu 'year'
      while (result_title)
      {
        result_title=nodes_title.iterateNext();
        count++;
      }
      string = "pocet vyskytov knih s rokom vydania " + x + ": " + count + "\n";

      string = string + "\n" + "Tituly tychto knih s ich autormi:" + "\n\n";

      //vlozenie obsahov hladanych detskych elementov 'title' a 'author' elementov 'book' do retazcoveho objektu 
      //'string' 
      while (result)
      {
        string = string + result.childNodes[0].nodeValue + "\n";
        result=nodes.iterateNext();
      }

      alert(string);
    }
  }
  </script>

</head>


<body>

  <script type="text/javascript">
  xml=loadXMLDoc("/diplomovka/kody/cvika/cviko_6/6_1/books.xml");  //tu je zavolana funkcia "loadXMLDoc"
  </script>
 

  <form>
  Finding a book element with the child element value: <input type="text" id="user_value" />
  </form>
  
  <script type="text/javascript">
  document.getElementById("user_value").focus();
  </script>

  <button type="button" onclick="Find_title_with_authors_year()">Display results</button>

</body>
</html>
