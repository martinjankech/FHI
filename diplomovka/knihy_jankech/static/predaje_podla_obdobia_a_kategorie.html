<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/footer.css">
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"
    integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
  <!-- jqury kniznica na obmedzenie maximalneho poctu poloziek v autocomplete  -->
  <script src="js/jquery.ui.autocomplete.scroll.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.css" rel="stylesheet" />
  <script src="js/app.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"></script>
  <link rel="stylesheet" href="css/datatable.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <script src="https://code.highcharts.com/modules/drilldown.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
    integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
  <link rel="stylesheet" href="css/predaje.css">

  <title>Document</title>
</head>

<body>
  <div id="navbar">
  </div>
  <div style="display: none;" id="alert_error">
    <div class="alert alert-danger" role="alert">
      <span id="alert-text"></span>
    </div>
  </div>
  <div style="display: none;" id="alert_success">
    <div class="alert alert-success" role="alert">
      <span id="alert-text"></span>
    </div>
  </div>
  <div class="flex-wrapper">
    <div class="container">
      <h1 class="mb-3 mt-5">Hľadaj údaje o predajoch kníh podľa: </h1>
      <form class="col-12" id="formSellAtributesDates" method="POST">
        <div class="form-row ">
          <div class="form-group col-md-6">
            <label for="startDate">Dátum od</label>
            <input type="date" class="form-control" id="startDate" placeholder="startdate">
          </div>
          <div class="form-group col-md-6">
            <label for="endDate">Dátum do</label>
            <input type="date" class="form-control" id="endDate" placeholder="enddate">
          </div>
        </div>
        <div class="form-row ">
          <div class="form-group col-md-6">
            <label for="atributeValue">Hladať podla Atribútu</label>
            <select id="selectedAtribute" class="form-control">
              <option disabled selected value> zvoľte si možnosť prosím </option>
              <option value="autor">autor</option>
              <option value="kategoria">kategória</option>
              <option value="vydavatelstvo">vydavateľstvo</option>
              <option value="jazyk">jazyk</option>
              <option value="vazba">väzba</option>
              <option value="rok_vydania">rok vydania</option>

            </select>
            <button type="submit" id="btnGetData" class="btn btn-primary mt-3">potvrdiť</button>
          </div>
          <div class="form-group col-md-6">
            <label for="sortingValue">Zoradiť podľa hodnoty</label>
            <select id="sortField" class="form-control" name="sortField">
              <option disabled selected value> zvolte si možnosť prosím </option>
              <option value="nazov">názov atribútu</option>
              <option value="hodnota">hodnota atribútu</option>


            </select>

            <div class="form-check mt-2">
              <input class="form-check-input" type="radio" name="sortOrder" id="ascending_Input" value="ascending"
                checked>
              <label class="form-check-label" for="exampleRadios1">
                Vzostupne
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="sortOrder" id="descendingInput" value="descending">
              <label class="form-check-label" for="exampleRadios2">
                Zostupne
              </label>
            </div>
          </div>
        </div>

      </form>
    </div>
    <div id="cards" class="container respo mt-5 mb-3">
      <div class="row  ">
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card revenue-card h-100">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-money-bill-wave"></i> Total Revenue
              </h5>
              <p class="card-text mt-auto " id="totalRevenue"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Average Daily Total Revenue
              </h5>
              <p class="card-text mt-auto" id="averageTotalDailyRevenue"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card revenue-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-money-bill-wave"></i> Max Revenue Podkategoria
              </h5>
              <p class="card-text mt-auto" id="namePodkategoriaMaxRevenue"></p>
              <p class="card-text mt-auto" id="maxRevenuePodkategoria"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Min Revenue Podkategoria
              </h5>
              <p class="card-text mt-auto" id="namePodkategoriaMinRevenue"></p>
              <p class="card-text mt-auto" id="minRevenuePodkategoria"></p>
            </div>
          </div>
        </div>

        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card revenue-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-money-bill-wave align-content-end"></i> Max Revenue Book
              </h5>
              <p class="card-text mt-auto" id="nameBookMaxRevenue"></p>
              <p class="card-text mt-auto" id="maxRevenueBook"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Min Revenue Book
              </h5>
              <p class="card-text mt-auto" id="nameBookMinRevenue"></p>
              <p class="card-text mt-auto" id="minRevenueBook"></p>
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid col-10 mt-4 mb-5" id="containerRevenue"></div>
      <div class="row  ">
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Total Quantity
              </h5>
              <p class="card-text mt-auto " id="totalQuantity"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Average Daily Total Quantity
              </h5>
              <p class="card-text mt-auto" id="averageTotalDailyQuantity"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Max Quantity Podkategoria
              </h5>
              <p class="card-text mt-auto" id="namePodkategoriaMaxQuantity"></p>
              <p class="card-text mt-auto" id="maxQuantityPodkategoria"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Min Quantity Podkategoria
              </h5>
              <p class="card-text mt-auto" id="namePodkategoriaMinQuantity"></p>
              <p class="card-text mt-auto" id="minQuantityPodkategoria"></p>
            </div>
          </div>
        </div>

        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Max Quantity Book
              </h5>
              <p class="card-text mt-auto" id="nameBookMaxQuantity"></p>
              <p class="card-text mt-auto" id="maxQuantityBook"></p>
            </div>
          </div>
        </div>
        <div class=" col-sm-6 col-md-4 col-lg-2 mb-3 pd-5 ">
          <div class="card quantity-card">
            <div class="card-body pb-5 d-flex flex-column">
              <h5 class="card-title">
                <i class="fas fa-box"></i> Min Quantity Book
              </h5>
              <p class="card-text mt-auto" id="nameBookMinQuantity"></p>
              <p class="card-text mt-auto" id="minQuantityBook"></p>
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid col-10 mt-4 mb-5" id="containerQuantity"></div>

    </div>








    <footer>

    </footer>
  </div>


</body>
<script>
  $("#navbar").load("navbar.html")
  $("footer").load("footer.html")
</script>
<script>

  $(document).on('submit', "#formSellAtributesDates", function (event) {

    var atribute = $("#selectedAtribute").val();
    var atributeText = $("#selectedAtribute option:selected").text();
    var startDate = $("#startDate").val();
    var endDate = $("#endDate").val();
    var sortingField = $("#sortField").val();
    var sortOrderValue = $("input[name='sortOrder']:checked").val();


    $.ajax({
      type: "POST",
      url: "http://localhost:8050/book_services.asmx/SortedDrillDownByAtributeDataBetweenTwoDatesSell",
      data: {
        atribute: atribute,
        startDate: startDate,
        endDate: endDate,
        sortingField: sortingField,
        sortingOrder: sortOrderValue,
        optionalParameter: "revenue"
      },

      dataType: "json",
      success: function (response) {
        try {
          var data = response;
          var podkategoriaDataRevenue = [];
          data.AggregatedData.forEach(function (podkategoria) {
            podkategoriaDataRevenue.push({
              name: podkategoria.Podkategoria,
              y: podkategoria.TotalRevenue,
              drilldown: podkategoria.Podkategoria
            });
          });
          console.log(podkategoriaDataRevenue)


          var bookDataRevenue = [];
          data.AggregatedData.forEach(function (podkategoria) {
            var booksRevenue = [];
            podkategoria.Books.forEach(function (book) {
              booksRevenue.push([book.Name, book.TotalRevenue]);
            });

            bookDataRevenue.push({
              name: podkategoria.Podkategoria,
              id: podkategoria.Podkategoria,
              data: booksRevenue
            });

          });



          let totalRevenue = Math.round(data.TotalAggregatedData.totalRevenue * 100) / 100;
          let averageTotalDailyRevenue = Math.round(data.TotalAggregatedData.averageTotalDailyRevenue * 100) / 100;
          let namePodkategoriaMaxRevenue = data.TotalAggregatedData.namePodkategoriaMaxRevenue;
          let maxRevenuePodkategoria = Math.round(data.TotalAggregatedData.maxRevenuePodkategoria * 100) / 100;
          let namePodkategoriaMinRevenue = data.TotalAggregatedData.namePodkategoriaMinRevenue;
          let minRevenuePodkategoria = Math.round(data.TotalAggregatedData.minRevenuePodkategoria * 100) / 100;
          let nameBookMaxRevenue = data.TotalAggregatedData.nameBookMaxRevenue;
          let maxRevenueBook = Math.round(data.TotalAggregatedData.maxRevenueBook * 100) / 100;
          let nameBookMinRevenue = data.TotalAggregatedData.nameBookMinRevenue;
          let minRevenueBook = Math.round(data.TotalAggregatedData.minRevenueBook * 100) / 100;
          document.getElementById("totalRevenue").innerHTML = totalRevenue;
          document.getElementById("averageTotalDailyRevenue").innerHTML = averageTotalDailyRevenue;
          document.getElementById("namePodkategoriaMaxRevenue").innerHTML = namePodkategoriaMaxRevenue;
          document.getElementById("maxRevenuePodkategoria").innerHTML = maxRevenuePodkategoria;
          document.getElementById("namePodkategoriaMinRevenue").innerHTML = namePodkategoriaMinRevenue;
          document.getElementById("minRevenuePodkategoria").innerHTML = minRevenuePodkategoria;
          document.getElementById("nameBookMaxRevenue").innerHTML = nameBookMaxRevenue;
          document.getElementById("maxRevenueBook").innerHTML = maxRevenueBook;
          document.getElementById("nameBookMinRevenue").innerHTML = nameBookMinRevenue;
          document.getElementById("minRevenueBook").innerHTML = minRevenueBook;












          //calculateCardBody()







          // Create the chart
          Highcharts.chart('containerRevenue', {
            chart: {
              type: 'column'
            },
            credits: {
              enabled: false
            },

            title: {
              text: "Príjmy podľa atribútu " + atributeText + " a jednotlivých kníh patriacich do atribútu"
            },
            xAxis: {
              type: 'category'
            },
            yAxis: {
              title: {
                text: 'Totálny príjem'
              }
            },
            legend: {
              enabled: false
            },
            plotOptions: {
              series: {
                borderWidth: 0,
                dataLabels: {
                  enabled: true,
                  format: '{point.y:.2f}€'
                }
              }
            },
            tooltip: {
              headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
              pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>€{point.y:.2f}</b><br/>'
            },
            series: [{
              name: atributeText,
              colorByPoint: true,
              data: podkategoriaDataRevenue
            }],
            drilldown: {
              series: bookDataRevenue
            }
          });
        } catch (error) {
          console.error(error);
          alert("An error occurred: " + error.message);
        }
        try {
          var podkategoriaDataQuantity = [];
          data.AggregatedData.forEach(function (podkategoria) {
            podkategoriaDataQuantity.push({
              name: podkategoria.Podkategoria,
              y: podkategoria.TotalQuantity,
              drilldown: podkategoria.Podkategoria
            });
          });
          console.log(podkategoriaDataQuantity)


          var bookDataQuantity = [];
          data.AggregatedData.forEach(function (podkategoria) {
            var booksQuantity = [];
            podkategoria.Books.forEach(function (book) {
              booksQuantity.push([book.Name, book.totalQuantity]);
            });

            bookDataQuantity.push({
              name: podkategoria.Podkategoria,
              id: podkategoria.Podkategoria,
              data: booksQuantity
            });

          });
          console.log(bookDataQuantity)

          let totalQuantity = data.TotalAggregatedData.totalQuantity;
          let averageTotalDailyQuantity = Math.round(data.TotalAggregatedData.averageTotalDailyQuantity * 100) / 100;
          let namePodkategoriaMaxQuantity = data.TotalAggregatedData.namePodkategoriaMaxQuantity;
          let maxQuantityPodkategoria = data.TotalAggregatedData.maxQuantityPodkategoria;
          let namePodkategoriaMinQuantity = data.TotalAggregatedData.namePodkategoriaMinQuantity;
          let minQuantityPodkategoria = data.TotalAggregatedData.minQuantityPodkategoria;
          let nameBookMaxQuantity = data.TotalAggregatedData.nameBookMaxQuantity;
          let maxQuantityBook = data.TotalAggregatedData.maxQuantityBook;
          let nameBookMinQuantity = data.TotalAggregatedData.nameBookMinQuantity;
          let minQuantityBook = data.TotalAggregatedData.minQuantityBook;
          document.getElementById("totalQuantity").innerHTML = totalQuantity;
          document.getElementById("averageTotalDailyQuantity").innerHTML = averageTotalDailyQuantity;
          document.getElementById("namePodkategoriaMaxQuantity").innerHTML = namePodkategoriaMaxQuantity;
          document.getElementById("maxQuantityPodkategoria").innerHTML = maxQuantityPodkategoria;
          document.getElementById("namePodkategoriaMinQuantity").innerHTML = namePodkategoriaMinQuantity;
          document.getElementById("minQuantityPodkategoria").innerHTML = minQuantityPodkategoria;
          document.getElementById("nameBookMaxQuantity").innerHTML = nameBookMaxQuantity;
          document.getElementById("maxQuantityBook").innerHTML = maxQuantityBook;
          document.getElementById("nameBookMinQuantity").innerHTML = nameBookMinQuantity;
          document.getElementById("minQuantityBook").innerHTML = minQuantityBook;
          Highcharts.chart('containerQuantity', {
            chart: {
              type: 'column'
            },
            credits: {
              enabled: false
            },

            title: {
              text: "Počty predaných kníh podľa atribútu " + atributeText + " a jednotlivých kníh patriacich do atribútu"
            },
            xAxis: {
              type: 'category'
            },
            yAxis: {
              title: {
                text: 'Totálne množstvo predaných kníh'
              }
            },
            legend: {
              enabled: false
            },
            plotOptions: {
              series: {
                borderWidth: 0,
                dataLabels: {
                  enabled: true,
                  format: '{point.y:.2f} ks'
                }
              }
            },
            tooltip: {
              headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
              pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f} ks </b><br/>'
            },
            series: [{
              name: atributeText,
              colorByPoint: true,
              data: podkategoriaDataQuantity
            }],
            drilldown: {
              series: bookDataQuantity
            }
          });
        }



        catch (error) {
          console.error(error);
          alert("An error occurred: " + error.message);
        }


      },
      error: function (xhr, ajaxOptions, thrownError) {
        alert(xhr.status + " " + thrownError);
      }

    });
    event.preventDefault();
  });





</script>
<script>
 // calculateCardBody()
</script>


</html>